webpackJsonp([79],{2136:function(n,l,t){"use strict";function e(n){return a._42(0,[(n()(),a._16(0,0,null,null,19,"ion-item",[["class","item item-block"]],null,null,null,E.b,E.a)),a._15(1,1097728,null,3,M.a,[K.a,N.a,a.p,a.K,[2,B.a]],null,null),a._37(335544320,5,{contentLabel:0}),a._37(603979776,6,{_buttons:1}),a._37(603979776,7,{_icons:1}),a._15(5,16384,null,0,H.a,[],null,null),(n()(),a._40(-1,2,["\n                "])),(n()(),a._16(7,0,null,1,4,"ion-label",[["stacked",""]],null,null,null,V.b,V.a)),a._15(8,4308992,null,0,W.a,[a.p,Y.a,b.a,j.a],{coreMarkRequired:[0,"coreMarkRequired"]},null),a._15(9,16384,[[5,4]],0,z.a,[N.a,a.p,a.K,[8,null],[8,""],[8,null],[8,null]],null,null),(n()(),a._40(10,0,["",""])),a._32(131072,Q.a,[Y.a,a.i]),(n()(),a._40(-1,2,["\n                "])),(n()(),a._16(13,0,null,3,5,"core-rich-text-editor",[["formControlName","content"],["item-content",""],["name","content"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,G.b,G.a)),a._15(14,1228800,null,0,J.a,[p.a,X.a,m.a,Z.a,[2,$.a],a.p,h.a,j.a,nn.a],{placeholder:[0,"placeholder"],control:[1,"control"],name:[2,"name"],component:[3,"component"],componentId:[4,"componentId"]},null),a._32(131072,Q.a,[Y.a,a.i]),a._15(16,671744,null,0,c.f,[[3,c.b],[8,null],[8,null],[8,null]],{name:[0,"name"]},null),a._35(2048,null,c.m,null,[c.f]),a._15(18,16384,null,0,c.n,[c.m],null,null),(n()(),a._40(-1,2,["\n            "]))],function(n,l){var t=l.component;n(l,8,0,t.textRequired);n(l,14,0,a._41(l,14,0,a._29(l,15).transform("addon.mod_workshop.submissioncontent")),t.editForm.controls.content,"content",t.component,t.componentId);n(l,16,0,"content")},function(n,l){n(l,10,0,a._41(l,10,0,a._29(l,11).transform("addon.mod_workshop.submissioncontent")));n(l,13,0,a._29(l,18).ngClassUntouched,a._29(l,18).ngClassTouched,a._29(l,18).ngClassPristine,a._29(l,18).ngClassDirty,a._29(l,18).ngClassValid,a._29(l,18).ngClassInvalid,a._29(l,18).ngClassPending)})}function i(n){return a._42(0,[(n()(),a._16(0,0,null,null,1,"core-attachments",[["allowOffline","true"]],null,null,null,ln.b,ln.a)),a._15(1,114688,null,0,tn.a,[en.a,p.a,b.a,g.a,Y.a,on.a],{files:[0,"files"],maxSize:[1,"maxSize"],maxSubmissions:[2,"maxSubmissions"],component:[3,"component"],componentId:[4,"componentId"],allowOffline:[5,"allowOffline"],acceptedTypes:[6,"acceptedTypes"],required:[7,"required"]},null)],function(n,l){var t=l.component;n(l,1,0,t.submission.attachmentfiles,t.workshop.maxbytes,t.workshop.nattachments,t.component,t.workshop.coursemodule,"true",t.workshop.submissionfiletypes,t.fileRequired)},null)}function o(n){return a._42(0,[(n()(),a._16(0,0,null,null,32,"form",[["ion-list",""],["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"submit"],[null,"reset"]],function(n,l,t){var e=!0;if("submit"===l){e=!1!==a._29(n,2).onSubmit(t)&&e}if("reset"===l){e=!1!==a._29(n,2).onReset()&&e}return e},null,null)),a._15(1,16384,null,0,c.w,[],null,null),a._15(2,540672,null,0,c.h,[[8,null],[8,null]],{form:[0,"form"]},null),a._35(2048,null,c.b,null,[c.h]),a._15(4,16384,null,0,c.o,[c.b],null,null),(n()(),a._40(-1,null,["\n            "])),(n()(),a._16(6,0,null,null,19,"ion-item",[["class","item item-block"],["text-wrap",""]],null,null,null,E.b,E.a)),a._15(7,1097728,null,3,M.a,[K.a,N.a,a.p,a.K,[2,B.a]],null,null),a._37(335544320,2,{contentLabel:0}),a._37(603979776,3,{_buttons:1}),a._37(603979776,4,{_icons:1}),a._15(11,16384,null,0,H.a,[],null,null),(n()(),a._40(-1,2,["\n                "])),(n()(),a._16(13,0,null,1,4,"ion-label",[["core-mark-required","true"],["stacked",""]],null,null,null,V.b,V.a)),a._15(14,4308992,null,0,W.a,[a.p,Y.a,b.a,j.a],{coreMarkRequired:[0,"coreMarkRequired"]},null),a._15(15,16384,[[2,4]],0,z.a,[N.a,a.p,a.K,[8,null],[8,""],[8,null],[8,null]],null,null),(n()(),a._40(16,0,["",""])),a._32(131072,Q.a,[Y.a,a.i]),(n()(),a._40(-1,2,["\n                "])),(n()(),a._16(19,0,null,3,5,"ion-input",[["formControlName","title"],["name","title"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,sn.b,sn.a)),a._15(20,671744,null,0,c.f,[[3,c.b],[8,null],[8,null],[8,null]],{name:[0,"name"]},null),a._35(2048,null,c.m,null,[c.f]),a._15(22,16384,null,0,c.n,[c.m],null,null),a._15(23,5423104,null,0,an.a,[N.a,nn.a,K.a,un.a,a.p,a.K,[2,$.a],[2,M.a],[2,c.m],rn.a],{type:[0,"type"],placeholder:[1,"placeholder"]},null),a._32(131072,Q.a,[Y.a,a.i]),(n()(),a._40(-1,2,["\n            "])),(n()(),a._40(-1,null,["\n\n            "])),(n()(),a._11(16777216,null,null,1,null,e)),a._15(28,16384,null,0,dn.k,[a.W,a.T],{ngIf:[0,"ngIf"]},null),(n()(),a._40(-1,null,["\n\n            "])),(n()(),a._11(16777216,null,null,1,null,i)),a._15(31,16384,null,0,dn.k,[a.W,a.T],{ngIf:[0,"ngIf"]},null),(n()(),a._40(-1,null,["\n        "]))],function(n,l){var t=l.component;n(l,2,0,t.editForm);n(l,14,0,"true");n(l,20,0,"title");n(l,23,0,"text",a._41(l,23,1,a._29(l,24).transform("addon.mod_workshop.submissiontitle")));n(l,28,0,t.textAvailable);n(l,31,0,t.fileAvailable)},function(n,l){n(l,0,0,a._29(l,4).ngClassUntouched,a._29(l,4).ngClassTouched,a._29(l,4).ngClassPristine,a._29(l,4).ngClassDirty,a._29(l,4).ngClassValid,a._29(l,4).ngClassInvalid,a._29(l,4).ngClassPending);n(l,16,0,a._41(l,16,0,a._29(l,17).transform("addon.mod_workshop.submissiontitle")));n(l,19,0,a._29(l,22).ngClassUntouched,a._29(l,22).ngClassTouched,a._29(l,22).ngClassPristine,a._29(l,22).ngClassDirty,a._29(l,22).ngClassValid,a._29(l,22).ngClassInvalid,a._29(l,22).ngClassPending)})}function s(n){return a._42(0,[(n()(),a._16(0,0,null,null,23,"ion-header",[],null,null,null,null,null)),a._15(1,16384,null,0,cn.a,[N.a,a.p,a.K,[2,hn.a]],null,null),(n()(),a._40(-1,null,["\n    "])),(n()(),a._16(3,0,null,null,19,"ion-navbar",[["class","toolbar"],["core-back-button",""]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,mn.b,mn.a)),a._15(4,49152,null,0,_n.a,[un.a,[2,hn.a],[2,fn.a],N.a,a.p,a.K],null,null),a._15(5,212992,null,0,pn.a,[_n.a,nn.a,Y.a,h.a],null,null),(n()(),a._40(-1,3,["\n        "])),(n()(),a._16(7,0,null,3,3,"ion-title",[],null,null,null,bn.b,bn.a)),a._15(8,49152,null,0,gn.a,[N.a,a.p,a.K,[2,vn.a],[2,_n.a]],null,null),(n()(),a._40(9,0,["",""])),a._32(131072,Q.a,[Y.a,a.i]),(n()(),a._40(-1,3,["\n        "])),(n()(),a._16(12,0,null,2,9,"ion-buttons",[["end",""]],null,null,null,null,null)),a._15(13,16384,null,1,kn.a,[N.a,a.p,a.K,[2,vn.a],[2,_n.a]],null,null),a._37(603979776,1,{_buttons:1}),(n()(),a._40(-1,null,["\n            "])),(n()(),a._16(16,0,null,null,4,"button",[["clear",""],["ion-button",""]],[[1,"aria-label",0]],[[null,"click"]],function(n,l,t){var e=!0;if("click"===l){e=!1!==n.component.save()&&e}return e},wn.b,wn.a)),a._15(17,1097728,[[1,4]],0,In.a,[[8,""],N.a,a.p,a.K],{clear:[0,"clear"]},null),a._32(131072,Q.a,[Y.a,a.i]),(n()(),a._40(19,0,["\n                ","\n            "])),a._32(131072,Q.a,[Y.a,a.i]),(n()(),a._40(-1,null,["\n        "])),(n()(),a._40(-1,3,["\n    "])),(n()(),a._40(-1,null,["\n"])),(n()(),a._40(-1,null,["\n"])),(n()(),a._16(25,0,null,null,9,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,Sn.b,Sn.a)),a._15(26,4374528,null,0,$.a,[N.a,nn.a,rn.a,a.p,a.K,un.a,yn.a,a.D,[2,hn.a],[2,fn.a]],null,null),(n()(),a._40(-1,1,["\n    "])),(n()(),a._16(28,0,null,1,5,"core-loading",[],null,null,null,Pn.b,Pn.a)),a._15(29,638976,null,0,Dn.a,[Y.a,a.p,h.a,j.a],{hideUntil:[0,"hideUntil"]},null),(n()(),a._40(-1,0,["\n        "])),(n()(),a._11(16777216,null,0,1,null,o)),a._15(32,16384,null,0,dn.k,[a.W,a.T],{ngIf:[0,"ngIf"]},null),(n()(),a._40(-1,0,["\n    "])),(n()(),a._40(-1,1,["\n"])),(n()(),a._40(-1,null,["\n"]))],function(n,l){var t=l.component;n(l,5,0);n(l,17,0,"");n(l,29,0,t.loaded);n(l,32,0,t.workshop)},function(n,l){n(l,3,0,a._29(l,4)._hidden,a._29(l,4)._sbPadding);n(l,9,0,a._41(l,9,0,a._29(l,10).transform("addon.mod_workshop.editsubmission")));n(l,16,0,a._41(l,16,0,a._29(l,18).transform("core.save")));n(l,19,0,a._41(l,19,0,a._29(l,20).transform("core.save")));n(l,25,0,a._29(l,26).statusbarPadding,a._29(l,26)._hasRefresher)})}Object.defineProperty(l,"__esModule",{value:!0});var a=t(1),u=(t(0),t(6),t(4)),r=t(29),d=t(33),c=t(24),h=t(11),m=t(2),_=t(81),f=t(182),p=t(5),b=t(12),g=t(74),v=t(180),k=t(205),w=t(192),I=function(){function n(n,l,t,e,i,o,s,a,u,r,d,h,m,_){this.fileUploaderProvider=t,this.workshopProvider=e,this.workshopOffline=i,this.workshopHelper=o,this.navCtrl=s,this.fileSessionprovider=a,this.syncProvider=u,this.textUtils=r,this.domUtils=d,this.fb=h,this.translate=m,this.eventsProvider=_,this.submission={id:0,title:"",content:"",attachmentfiles:[]},this.loaded=!1,this.component=v.a.COMPONENT,this.originalData={},this.hasOffline=!1,this.editing=!1,this.forceLeave=!1,this.isDestroyed=!1,this.textAvailable=!1,this.textRequired=!1,this.fileAvailable=!1,this.fileRequired=!1,this.module=n.get("module"),this.courseId=n.get("courseId"),this.access=n.get("access"),this.submissionId=n.get("submissionId"),this.workshopId=this.module.instance,this.componentId=this.module.id,this.userId=l.getCurrentSiteUserId(),this.siteId=l.getCurrentSiteId(),this.editForm=new c.g({}),this.editForm.addControl("title",this.fb.control("",c.u.required)),this.editForm.addControl("content",this.fb.control(""))}return n.prototype.ngOnInit=function(){this.isDestroyed||this.syncProvider.blockOperation(this.component,this.workshopId),this.fetchSubmissionData()},n.prototype.ionViewCanLeave=function(){var n=this;if(this.forceLeave)return!0;return(this.hasDataChanged()?this.domUtils.showConfirm(this.translate.instant("core.confirmcanceledit")):Promise.resolve()).then(function(){n.submission.attachmentfiles&&n.fileUploaderProvider.clearTmpFiles(n.submission.attachmentfiles)})},n.prototype.fetchSubmissionData=function(){var n=this;return this.workshopProvider.getWorkshop(this.courseId,this.module.id).then(function(l){if(n.workshop=l,n.textAvailable=n.workshop.submissiontypetext!=v.a.SUBMISSION_TYPE_DISABLED,n.textRequired=n.workshop.submissiontypetext==v.a.SUBMISSION_TYPE_REQUIRED,n.fileAvailable=n.workshop.submissiontypefile!=v.a.SUBMISSION_TYPE_DISABLED,n.fileRequired=n.workshop.submissiontypefile==v.a.SUBMISSION_TYPE_REQUIRED,n.editForm.controls.content.setValidators(n.textRequired?c.u.required:null),n.submissionId>0)return n.editing=!0,n.workshopHelper.getSubmissionById(n.workshopId,n.submissionId).then(function(l){n.submission=l;n.userId==l.authorid&&n.access.cansubmit&&n.access.modifyingsubmissionallowed||n.forceLeavePage()});n.access.cansubmit&&n.access.creatingsubmissionallowed||n.forceLeavePage()}).then(function(){return n.workshopOffline.getSubmissions(n.workshopId).then(function(l){if(l&&l.length){n.hasOffline=!0;var t=n.workshopHelper.filterSubmissionActions(l,n.editing?n.submission.id:0);return n.workshopHelper.applyOfflineData(n.submission,t)}n.hasOffline=!1}).finally(function(){n.originalData.title=n.submission.title,n.originalData.content=n.submission.content,n.originalData.attachmentfiles=[],n.submission.attachmentfiles.forEach(function(l){var t;t=l.filename?l.filename:"/"==l.filepath[0]?l.filepath.substr(1):l.filepath,n.originalData.attachmentfiles.push({filename:t,fileurl:l.fileurl})})})}).then(function(){n.editForm.controls.title.setValue(n.submission.title),n.editForm.controls.content.setValue(n.submission.content);n.fileSessionprovider.setFiles(n.component,n.workshopId+"_"+(n.submission.id||"newsub"),n.submission.attachmentfiles||[]),n.loaded=!0}).catch(function(l){n.loaded=!1,n.domUtils.showErrorModalDefault(l,"core.course.errorgetmodule",!0),n.forceLeavePage()})},n.prototype.forceLeavePage=function(){this.forceLeave=!0,this.navCtrl.pop()},n.prototype.getInputData=function(){var n=this.submission.id||"newsub",l={title:this.editForm.value.title,content:null,attachmentfiles:[]};return this.textAvailable&&(l.content=this.editForm.value.content||""),this.fileAvailable&&(l.attachmentfiles=this.fileSessionprovider.getFiles(this.component,this.workshopId+"_"+n)||[]),l},n.prototype.hasDataChanged=function(){if(!this.loaded)return!1;var n=this.getInputData();return!(!this.originalData||void 0===this.originalData.title)&&(!!(this.originalData.title!=n.title||this.textAvailable&&this.originalData.content!=n.content)||!!this.fileAvailable&&this.fileUploaderProvider.areFileListDifferent(n.attachmentfiles,this.originalData.attachmentfiles))},n.prototype.save=function(){var n=this;this.hasDataChanged()?this.saveSubmission().then(function(){n.forceLeavePage()}).catch(function(){}):this.forceLeavePage()},n.prototype.saveSubmission=function(){var n=this,l=this.getInputData();if(!l.title)return this.domUtils.showAlertTranslated("core.notice","addon.mod_workshop.submissionrequiredtitle"),Promise.reject(null);var t=this.textUtils.htmlIsBlank(l.content),e=!l.attachmentfiles.length;if(this.textRequired&&t||this.fileRequired&&e||t&&e)return this.domUtils.showAlertTranslated("core.notice","addon.mod_workshop.submissionrequiredcontent"),Promise.reject(null);var i=!0,o=!1,s=this.domUtils.showModalLoading("core.sending",!0),a=this.submission.id;return this.textAvailable&&(l.content=this.textUtils.formatHtmlLines(l.content)),i=!l.attachmentfiles.length,this.workshopHelper.uploadOrStoreSubmissionFiles(this.workshopId,this.submission.id,l.attachmentfiles,this.editing,o).catch(function(){return o=!0,i=!0,n.workshopHelper.uploadOrStoreSubmissionFiles(n.workshopId,n.submission.id,l.attachmentfiles,n.editing,o)}).then(function(t){return o||n.fileAvailable||(t=null),n.editing?o?n.workshopOffline.saveSubmission(n.workshopId,n.courseId,l.title,l.content,t,a,"update").then(function(){}):n.workshopProvider.updateSubmission(n.workshopId,a,n.courseId,l.title,l.content,t,void 0,i):o?n.workshopOffline.saveSubmission(n.workshopId,n.courseId,l.title,l.content,t,a,"add").then(function(){}):n.workshopProvider.addSubmission(n.workshopId,n.courseId,l.title,l.content,t,void 0,a,i)}).then(function(t){var e={workshopId:n.workshopId,cmId:n.module.cmid};t&&a&&(n.workshopOffline.deleteSubmissionAction(n.workshopId,a,n.editing?"update":"add"),n.workshopHelper.deleteSubmissionStoredFiles(n.workshopId,a,n.editing),e.submissionId=t);return(t?n.workshopProvider.invalidateSubmissionData(n.workshopId,t):Promise.resolve()).finally(function(){n.eventsProvider.trigger(v.a.SUBMISSION_CHANGED,e,n.siteId),n.fileUploaderProvider.clearTmpFiles(l.attachmentfiles)})}).catch(function(l){n.domUtils.showErrorModalDefault(l,"Cannot save submission")}).finally(function(){s.dismiss()})},n.prototype.ngOnDestroy=function(){this.isDestroyed=!0,this.syncProvider.unblockOperation(this.component,this.workshopId)},n}(),S=function(){return function(){}}(),y=t(1524),P=t(1525),D=t(1526),C=t(1527),x=t(1528),U=t(1529),O=t(1530),q=t(1531),A=t(1532),F=t(1533),R=t(1534),L=t(1535),T=t(1536),E=t(31),M=t(21),K=t(20),N=t(9),B=t(27),H=t(34),V=t(96),W=t(86),Y=t(18),j=t(3),z=t(68),Q=t(26),G=t(318),J=t(254),X=t(23),Z=t(19),$=t(30),nn=t(17),ln=t(485),tn=t(319),en=t(10),on=t(153),sn=t(113),an=t(93),un=t(36),rn=t(35),dn=t(8),cn=t(375),hn=t(40),mn=t(725),_n=t(214),fn=t(22),pn=t(478),bn=t(726),gn=t(316),vn=t(251),kn=t(376),wn=t(46),In=t(42),Sn=t(186),yn=t(110),Pn=t(55),Dn=t(52),Cn=t(71),xn=a._14({encapsulation:2,styles:[],data:{}}),Un=a._12("page-addon-mod-workshop-edit-submission",I,function(n){return a._42(0,[(n()(),a._16(0,0,null,null,1,"page-addon-mod-workshop-edit-submission",[],null,null,null,s,xn)),a._15(1,245760,null,0,I,[Cn.a,m.a,g.a,v.a,w.a,k.a,fn.a,f.a,_.a,b.a,p.a,c.d,Y.a,h.a],null,null)],function(n,l){n(l,1,0)},null)},{},{},[]),On=t(371),qn=t(372),An=t(374),Fn=t(373),Rn=t(477),Ln=t(724),Tn=t(109),En=t(274);t.d(l,"AddonModWorkshopEditSubmissionPageModuleNgFactory",function(){return Mn});var Mn=a._13(S,[],function(n){return a._25([a._26(512,a.n,a._6,[[8,[y.a,P.a,D.a,C.a,x.a,U.a,O.a,q.a,A.a,F.a,R.a,L.a,T.a,Un]],[3,a.n],a.B]),a._26(4608,dn.m,dn.l,[a.x,[2,dn.w]]),a._26(4608,c.x,c.x,[]),a._26(4608,c.d,c.d,[]),a._26(4608,On.b,On.a,[]),a._26(4608,qn.a,qn.b,[]),a._26(4608,An.b,An.a,[]),a._26(4608,Fn.b,Fn.a,[]),a._26(4608,Y.a,Y.a,[Rn.a,On.b,qn.a,An.b,Fn.b,Y.b,Y.c]),a._26(512,d.a,d.a,[]),a._26(512,dn.b,dn.b,[]),a._26(512,c.v,c.v,[]),a._26(512,c.i,c.i,[]),a._26(512,c.s,c.s,[]),a._26(512,Ln.a,Ln.a,[]),a._26(512,u.a,u.a,[]),a._26(512,Tn.a,Tn.a,[]),a._26(512,r.a,r.a,[]),a._26(512,Ln.b,Ln.b,[]),a._26(512,S,S,[]),a._26(256,Y.c,void 0,[]),a._26(256,Y.b,void 0,[]),a._26(256,En.a,I,[])])})}});